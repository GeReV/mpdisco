/*! mpdisco 2014-06-26 */
define(["marionette","network","handlebars","underscore"],function(a,b,c,d){d.findIndex=function(a,b,c){var e=-1;return d.any(a,function(a,d,f){return b.call(c,a,d,f)?(e=d,!0):void 0}),e},c.registerHelper("time",function(a){a=a||"";var b=a.split(":");return new c.SafeString('<span class="time running">'+f.Utils.formatSeconds(b[0])+"</span>"+(b.length>1?' / <span class="time length">'+f.Utils.formatSeconds(b[1])+"</span>":""))}),a.TemplateCache.prototype.loadTemplate=function(a){return c.templates[a]},a.TemplateCache.prototype.compileTemplate=function(a){return a};var e=function(a){return{constructor:function(){this.socketEvents&&d.size(this.socketEvents)>0&&(this.delegateSocketEvents(this.socketEvents),this.socketOff=function(a){var b=this.socketEvents[a];if(d.isFunction(b)||(b=this[this.socketEvents[a]]),!b)throw new Error('Method "'+this.socketEvents[a]+'" does not exist');f.network.off(a,b)}.bind(this));var b=Array.prototype.slice.apply(arguments);a.prototype.constructor.apply(this,b)},delegateSocketEvents:function(a){for(var b in a){var c=a[b];if(d.isFunction(c)||(c=this[a[b]]),!c)throw new Error('Method "'+a[b]+'" does not exist');c=d.bind(c,this),f.network.on(b,c)}}}},f=new a.Application;a.View=a.View.extend(e(a.View)),a.ItemView=a.ItemView.extend(e(a.ItemView)),a.CollectionView=a.CollectionView.extend(e(a.CollectionView)),a.CompositeView=a.CompositeView.extend(e(a.CompositeView)),f.Collection=Backbone.Collection.extend(e(Backbone.Collection)),f.Model=Backbone.Model.extend(e(Backbone.Model));var g=window.location.hostname;return f.network=new b(g,3e3),f.command=f.network.command.bind(f.network),f.commands=f.network.commands.bind(f.network),f.Utils={formatSeconds:function(a){return Math.floor(+a/60)+":"+f.Utils.pad(+a%60)},pad:function(a){return 10>+a?"0"+a:a}},f.Error=f.Model.extend({socketEvents:{error:"set"}}),f.ErrorView=a.ItemView.extend({className:"error",template:"error",model:new f.Error,modelEvents:{change:"show"},socketEvents:{error:"show"},events:{"click .close":"hide"},show:function(){this.render(),this.$el.addClass("shown")},hide:function(){this.$el.removeClass("shown")}}),f.State=f.Model.extend({socketEvents:{status:"set"}}),f.state=new f.State,f.Layout=a.LayoutView.extend({template:"layout",regions:{player:"#player",user:"#user",scrubber:"#scrubber",playlist:"#playlist",listeners:"#listeners",library:"#library",error:"#error"}}),f.addRegions({container:"#container"}),f.addInitializer(function(){Backbone.history&&Backbone.history.start()}),f.addInitializer(function(){f.mode=f.module("MasterMode").Mode,this.layout=new f.Layout,this.container.show(this.layout),this.layout.player.show(new f.mode.player),this.layout.user.show(new f.mode.user),this.layout.scrubber.show(new f.mode.scrubber),this.layout.playlist.show(new f.mode.playlist),this.layout.listeners.show(new f.mode.listeners),this.layout.library.show(new f.mode.library),this.layout.error.show(new f.ErrorView),this.network.command("status")}),f});