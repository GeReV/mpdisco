/*! mpdisco 2014-06-26 */
define(["mpdisco","player","user","playlist","library"],function(a,b,c,d,e){var f=a.module("MasterMode",function(a,f){var g=function(a){return{socketEvents:{master:"onMasterChanged"},initialize:function(){a.prototype.initialize.call(this),this.listenTo(f.vent,"networkready",this.onConnected)},onConnected:function(a){this.updateLock(a.master)},onMasterChanged:function(a){this.updateLock(a)},updateLock:function(a){var b=!0;a=a||f.meta.master,a&&a.userid&&f.meta.id&&(b=a.userid!==f.meta.id),this.locked=b,this.setLockUI(b)}}};a.PlayerView=b.PlayerView.extend(_.extend(g(b.PlayerView),{setLockUI:function(a){this.$(".btn").attr("disabled",a)},onDomRefresh:function(){this.updateLock()}})),a.PlaylistView=d.PlaylistView.extend(_.extend(g(d.PlaylistView),{setLockUI:function(a){this.pluginsInitialized&&this.ui.playlist.sortable(a?"disable":"enable"),this.ui.url.prop("disabled",a),this.ui.repeat.toggleClass("disabled",a),this.ui.shuffle.toggleClass("disabled",a)},onRender:function(){d.PlaylistView.prototype.onCompositeCollectionRendered.call(this),this.updateLock()},setRemoveButton:function(){this.ui.remove.toggleClass("disabled",this.$(".selected").length<=0||this.locked)}})),a.LibrarySongView=e.LibrarySongView.extend(_.extend(g(e.LibrarySongView),{onDomRefresh:function(){e.LibrarySongView.prototype.onDomRefresh.call(this),this.updateLock()},setLockUI:function(a){this.$el.draggable(a?"disable":"enable")}})),a.LibraryAlbumView=e.LibraryAlbumView.extend(_.extend(g(e.LibraryAlbumView),{itemView:a.LibrarySongView,onDomRefresh:function(){e.LibraryAlbumView.prototype.onDomRefresh.call(this),this.updateLock()},setLockUI:function(a){this.$el.draggable(a?"disable":"enable")}})),a.LibraryArtistView=e.LibraryArtistView.extend(_.extend(g(e.LibraryArtistView),{itemView:a.LibraryAlbumView,onDomRefresh:function(){e.LibraryArtistView.prototype.onDomRefresh.call(this),this.updateLock()},setLockUI:function(a){this.$el.draggable(a?"disable":"enable")}})),a.LibraryView=e.LibraryView.extend({itemView:a.LibraryArtistView}),a.ListenersView=c.ListenersView.extend({socketEvents:{master:"setMaster",clientslist:"updateClients"},initialize:function(){c.ListenersView.prototype.initialize.call(this),this.listenTo(f.vent,"networkready",function(a){this.clients=a.clients||[],this.setMaster(a.master)}),this.listenTo(this,"render after:item:added after:item:removed",this.requestUpdateClients,this)},setMaster:function(a){this.master=a,this.requestUpdateClients()},updateMaster:function(){var a,b;this.master&&(this.$(".listener").removeClass("up-next master"),this.$('[data-id="'+this.master.userid+'"]').addClass("master"),a=_.findIndex(this.clients,function(a){return a.userid===this.master.userid},this),-1!==a&&(b=this.clients[(a+1)%this.clients.length],b.userid!==this.master.userid&&this.$('[data-id="'+b.userid+'"]').addClass("up-next")))},requestUpdateClients:function(){f.network.send("clientslist")},updateClients:function(a){this.clients=a,this.updateMaster()}}),a.Mode={player:a.PlayerView,user:c.UserView,scrubber:b.ScrubberView,playlist:a.PlaylistView,listeners:a.ListenersView,library:a.LibraryView}});return f});